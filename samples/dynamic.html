<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
    <title>Onde Sample</title>
    <link rel="stylesheet" href="../src/onde.css" type="text/css"/>
  </head>
  <body>

<h1>Onde</h1>

<h2>Schema</h2>
<form id="launcher-form" action="">
<p>Schema URL: <input type="text" id="schema-load-input" style="width: 40em" />
<br/>Data URL: <input type="text" id="schema-load-data-url" style="width: 40em" />
<br/><button type="submit" id="schema-load-submit">Load</button></p>
</form>

<h2>Data Input</h2>
<form id="entry-form" class="onde-form" method="post">
<div class="main">
</div>
<p>
	<button type="submit" name="submit" value="dump_json">Get JSON</button>
</p>
</form>

<script type="application/javascript" src="jquery-1.6.3.min.js"></script>
<script type="application/javascript" src="../src/onde.js"></script>
<script type="application/javascript">
function getHashParameterByName(name)
{
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  var hash = window.location.hash || '#';
  var regexS = "[\\#&]" + name + "=([^&#]*)";
  var regex = new RegExp(regexS);
  var results = regex.exec(hash);
  if(results == null)
    return "";
  else
    return decodeURIComponent(results[1].replace(/\+/g, " "));
}
$(document).ready(function () {
//    console.log(window.location);
    
    var schemaURL = getHashParameterByName('schema');
    var dataURL = getHashParameterByName('data');
	var jform = new onde.Onde($("#entry-form")[0]);
	function loadForm() {
	    if (!schemaURL) {
	        return;
        }
		$.getJSON(schemaURL, function (schema) {
			if (dataURL) {
				$.getJSON(dataURL, function (data) {
					jform.render(schema, data, { schemaURL: schemaURL, dataURL: dataURL });
				});
			} else {
				jform.render(schema, null, { schemaURL: schemaURL });
			}
		});
    }
	$('#launcher-form').submit(function (evt) {
		evt.preventDefault();
		schemaURL = $('#schema-load-input').val();
		dataURL = $('#schema-load-data-url').val();
	    if (!schemaURL) {
	        alert("No schema URL provided");
	        return false;
        }
        //TODO: Change the current location appropriately
		loadForm();
		return false;
	});
	$('#schema-load-input').val(schemaURL);
	$('#schema-load-data-url').val(dataURL);
	loadForm();
});
</script>

<h2>Output</h2>
<pre id="json-output" style="overflow: auto; padding: 8px; border: 1px solid #ccc; border-radius: 3px; background-color: #f3f3f3"></pre>

  </body>
</html>
